(this["webpackJsonpaave-react"]=this["webpackJsonpaave-react"]||[]).push([[0],{113:function(e,t,n){},209:function(e,t,n){},225:function(e,t){},228:function(e,t){},231:function(e,t){},235:function(e,t){},262:function(e,t){},264:function(e,t){},278:function(e,t){},280:function(e,t){},311:function(e,t){},313:function(e,t){},405:function(e,t){},406:function(e,t){},499:function(e,t,n){},500:function(e,t,n){},501:function(e,t,n){"use strict";n.r(t);n(204);var a=n(15),s=n.n(a),r=n(200),c=n.n(r),o=(n(209),n(14)),l=n(46),i=n(17),u=n.n(i),d=(n(113),n(1));var b=function(){return Object(d.jsx)("div",{className:"App-header",children:Object(d.jsx)("h1",{children:"AAVE Interest Calculator"})})},h=n(4),j=n(5),p=n(20),O=n(9),x=n(10),m=n(79),f=n.n(m),v=(n(499),function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(h.a)(this,n),(a=t.call(this,e)).state={value:a.props.address},a.address=a.state.value,a.stateChanger=a.props.stateChanger,a.handleChange=a.handleChange.bind(Object(p.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(p.a)(a)),a.connectMetamask=a.connectMetamask.bind(Object(p.a)(a)),a}return Object(j.a)(n,[{key:"handleChange",value:function(e){this.setState({value:e.target.value})}},{key:"handleSubmit",value:function(e){var t=this.state.value.toLowerCase();f.a.utils.isAddress(t)?(this.stateChanger(t),this.address=t):alert("Invalid ethereum address: "+t),e.preventDefault()}},{key:"connectMetamask",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var n,a,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(){return(a=Object(l.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new f.a(f.a.givenProvider||"ws://localhost:8545"),e.next=3,t.eth.requestAccounts();case 3:return n=e.sent,console.log("update state",n[0]),e.abrupt("return",n[0].toLowerCase());case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)},n=function(){return a.apply(this,arguments)},console.log("event",t),e.next=5,n();case 5:s=e.sent,console.log("mmaccount",s),this.setState({value:s}),this.stateChanger(s),this.address=s;case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return Object(d.jsx)("form",{onSubmit:this.handleSubmit,children:Object(d.jsxs)("div",{className:"row",children:[Object(d.jsxs)("div",{className:"col-8",children:[Object(d.jsx)("label",{for:"addressInput",children:"Address:"}),Object(d.jsx)("input",{id:"addressInput",type:"text",value:this.state.value,onChange:this.handleChange}),Object(d.jsx)("input",{type:"submit",value:"Manual",className:"btn btn-secondary"})]}),Object(d.jsx)("div",{className:"col-4",children:Object(d.jsx)("button",{type:"button",className:"btn btn-dark float-end",onClick:this.connectMetamask,children:"Connect Metamask"})})]})})}}]),n}(a.Component)),g=v,w=(n(500),function(e){Object(O.a)(n,e);var t=Object(x.a)(n);function n(e){var a;return Object(h.a)(this,n),(a=t.call(this,e)).state={value:a.props.network},a.stateChanger=a.props.stateChanger,a.handleChange=a.handleChange.bind(Object(p.a)(a)),a}return Object(j.a)(n,[{key:"handleChange",value:function(e){this.setState({value:e.target.value}),this.stateChanger(e.target.value)}},{key:"render",value:function(){return Object(d.jsx)("form",{children:Object(d.jsx)("div",{className:"row justify-content-end mt-2",children:Object(d.jsx)("div",{className:"col-3",children:Object(d.jsxs)("select",{id:"selectNetwork",className:"form-select",value:this.state.value,onChange:this.handleChange,children:[Object(d.jsx)("option",{value:"eth",children:"Mainnet"}),Object(d.jsx)("option",{value:"avax",children:"Avalanche"}),Object(d.jsx)("option",{value:"matic",children:"Matic"})]})})})})}}]),n}(a.Component)),k=n(506),y=Intl.NumberFormat("en-US",{style:"currency",currency:"USD",currencySign:"accounting"}),S=Intl.NumberFormat("en-US",{style:"percent",minimumFractionDigits:2}),C="https://api.thegraph.com/subgraphs/name/aave/protocol-v2-avalanche",A="https://api.thegraph.com/subgraphs/name/aave/aave-v2-matic",T="https://api.thegraph.com/subgraphs/name/aave/protocol-v2",D="\nquery {\n  reserves (where: {}) {\n    id\n    name\n    price {\n      id\n      priceInEth\n    }\n    liquidityRate\n    variableBorrowRate\n    stableBorrowRate\n    aEmissionPerSecond\n    vEmissionPerSecond\n    decimals\n    totalATokenSupply\n    totalCurrentVariableDebt\n    symbol\n  }\n}\n",N={};function M(e){return R.apply(this,arguments)}function R(){return(R=Object(l.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=t.replace(".e","").replace("W",""))in N)){e.next=4;break}e.next=17;break;case 4:if("USDT"===t){e.next=16;break}if("XSUSHI"===t){e.next=11;break}return e.next=8,fetch("https://api.binance.com/api/v3/ticker/price?symbol=".concat(t,"USDT")).then((function(e){return e.json()})).catch((function(e){return-1})).then((function(e){return e.hasOwnProperty("price")?parseFloat(e.price):(console.log("fetched from binance: ",t,N[t]),-1)}));case 8:N[t]=e.sent,e.next=14;break;case 11:return e.next=13,fetch("https://api.coingecko.com/api/v3/simple/price?ids=".concat(t,"&vs_currencies=usd")).then((function(e){return e.json()})).catch((function(e){return-1})).then((function(e){return e.hasOwnProperty(t.toLowerCase())?parseFloat(e[t.toLowerCase()].usd):(console.log("fetched from coingecko: ",t,N[t]),-1)}));case 13:N[t]=e.sent;case 14:e.next=17;break;case 16:return e.abrupt("return",1);case 17:return e.abrupt("return",N[t]);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return U.apply(this,arguments)}function U(){return(U=Object(l.a)(u.a.mark((function e(t){var n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M(t);case 2:return n=e.sent,e.next=5,M("ETH");case 5:return a=e.sent,console.log("eth price of ",t,a),e.abrupt("return",n/a);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var E=Object(k.a)({url:C}),I=Object(k.a)({url:T}),P={matic:Object(k.a)({url:A}),avax:E,eth:I},B={matic:"WMATIC",avax:"WAVAX",eth:"WETH"};var W=function(){var e=Math.pow(10,27),t=Math.pow(10,18),n=Math.pow(10,18),s=31536e3,r=Object(a.useState)(""),c=Object(o.a)(r,2),i=c[0],h=c[1],j=Object(a.useState)("avax"),p=Object(o.a)(j,2),O=p[0],x=p[1],m=Object(a.useState)({}),f=Object(o.a)(m,2),v=f[0],k=f[1],C=Object(a.useState)([]),A=Object(o.a)(C,2),T=(A[0],A[1]),N=Object(a.useState)([]),R=Object(o.a)(N,2),U=R[0],E=R[1],I=Object(a.useState)({}),W=Object(o.a)(I,2),_=W[0],q=W[1],L=Object(a.useState)([]),V=Object(o.a)(L,2),H=V[0],X=V[1],Y=Object(a.useState)({}),J=Object(o.a)(Y,2),z=J[0],G=J[1];function K(){return(K=Object(l.a)(u.a.mark((function a(){var r,c,l,d,b,h,j,p,x,m,f,v,g,w,C,A,N,R,U,I,W,_,L,V,H,Y,J,z,K,Q,Z,$,ee,te,ne,ae,se,re,ce,oe,le,ie,ue,de,be,he,je,pe,Oe,xe,me,fe,ve,ge,we,ke,ye,Se,Ce,Ae,Te;return u.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i&&0!==i.length){a.next=2;break}return a.abrupt("return");case 2:return T([]),E([]),q({}),k({}),X([]),G({}),r='\n    {\n      userReserves(where: { user: "'.concat(i,'"}) {\n        id\n        reserve{\n          id\n          symbol\n        }\n        currentATokenBalance\n        currentTotalDebt\n      }\n    }\n    '),console.log("query",r),c=P[O],l=B[O],a.next=14,c.query(r).toPromise();case 14:d=a.sent,console.log("resp",d),T(d.data.userReserves),b=[],h={deposits:0,debt:0,sum:0},j=[],p={native:0,rewards:0,sum:0},x=["ETH","MATIC","AVAX"],m=0;case 23:if(!(m<d.data.userReserves.length)){a.next=49;break}return f=d.data.userReserves[m],v=f.reserve.symbol,g=t,(v.indexOf("USDC")>-1||v.indexOf("USDT")>-1)&&(g=Math.pow(10,6)),w=parseFloat(f.currentATokenBalance)/g,C=parseFloat(f.currentTotalDebt)/g,A={symbol:v,debt:0,deposits:0},console.log("tally",v,w,C),a.next=34,M(v);case 34:if(-1!==(N=a.sent)){a.next=37;break}return a.abrupt("continue",46);case 37:w>0&&(A.deposits+=w*N),C>0&&(A.debt+=C*N),h.deposits+=A.deposits,h.debt+=A.debt,h.sum+=A.deposits-A.debt,A.sum=y.format(A.deposits-A.debt),A.deposits=y.format(A.deposits),A.debt=y.format(A.debt),(w>0||C>0)&&(x.push(v),b.push(A));case 46:m++,a.next=23;break;case 49:return console.log("token list",x),console.log(O),console.log(c),a.next=54,c.query(D).toPromise();case 54:return R=a.sent,U={},a.next=58,F(l.replace("W",""));case 58:I=a.sent,m=0;case 60:if(!(m<R.data.reserves.length)){a.next=96;break}if(W=R.data.reserves[m],_=W.symbol,console.log("111111",_,x),x.includes(_)){a.next=66;break}return a.abrupt("continue",93);case 66:return L=parseFloat(W.variableBorrowRate),V=parseFloat(W.liquidityRate),H=parseFloat(W.aEmissionPerSecond),Y=parseFloat(W.vEmissionPerSecond),J=parseFloat(W.totalCurrentVariableDebt),z=parseFloat(W.totalATokenSupply),a.next=74,F(_);case 74:K=a.sent,Q=Math.pow(10,parseFloat(W.decimals)),Z=V/e,$=L/e,ee=Math.pow(1+Z/s,s)-1,te=Math.pow(1+$/s,s)-1,ne=H*s,ae=Y*s,console.log("======================== "+_+" ================================="),console.log("(aEmissionPerYear * REWARD_PRICE_ETH * WEI_DECIMALS)",ne,I,t),console.log("(totalATokenSupply * token_price_eth * underlying_token_decimals)",z,K,Q),console.log("======================== "+_+" ================================="),se=ne*I*Q/(z*K*n),re=ae*I*Q/(J*K*n),Math.pow(1+se/365,365)-1,Math.pow(1+re/365,365)-1,U[_]={deposit:{native:ee},borrow:{native:te}},U[_].deposit.rewards=se,U[_].borrow.rewards=J>0?re:0;case 93:m++,a.next=60;break;case 96:console.log("rate",U),k(U),m=0;case 99:if(!(m<d.data.userReserves.length)){a.next=135;break}if(ce=d.data.userReserves[m],oe=ce.reserve.symbol,x.includes(oe)){a.next=104;break}return a.abrupt("continue",132);case 104:if(console.log(oe,x),le=t,(oe.indexOf("USDC")>-1||oe.indexOf("USDT")>-1)&&(le=Math.pow(10,6)),ie=parseFloat(ce.currentATokenBalance)/le,ue=parseFloat(ce.currentTotalDebt)/le,0!==ie||0!==ue){a.next=111;break}return a.abrupt("continue",132);case 111:return console.log("Annual rewards for this symbol",oe),de=ie*U[oe].deposit.native-ue*U[oe].borrow.native,a.next=115,M(oe);case 115:return be=a.sent,he=de*be,console.log("nativeusd",he),a.next=120,M("AVAX");case 120:je=a.sent,pe=ie*be*U[oe].deposit.rewards,Oe=ue*be*U[oe].borrow.rewards,xe=(pe+Oe)/je,console.log(oe+" Rewards",pe,Oe),me=pe+Oe,console.log("rewards",me),p.native+=he,p.rewards+=me,p.sum+=he+me,fe={symbol:oe,native:{USD:y.format(he),native:de},rewards:{USD:y.format(me),WAVAX:xe},total:{USD:y.format(he+me)}},j.push(fe);case 132:m++,a.next=99;break;case 135:for(ve=0,ge=Object.entries(U);ve<ge.length;ve++)for(we=Object(o.a)(ge[ve],2),ke=we[0],ye=we[1],Se=0,Ce=Object.entries(ye);Se<Ce.length;Se++)Ae=Object(o.a)(Ce[Se],2),Te=Ae[0],Ae[1],console.log("1",U[ke][Te].native),console.log("2",U[ke][Te].rewards),U[ke][Te].native=S.format(U[ke][Te].native),U[ke][Te].rewards=S.format(U[ke][Te].rewards),console.log("3",U[ke][Te].native),console.log("4",U[ke][Te].rewards);console.log(U),k(U),h.deposits=y.format(h.deposits),h.debt=y.format(h.debt),h.sum=y.format(h.sum),p.native=y.format(p.native),p.rewards=y.format(p.rewards),p.sum=y.format(p.sum),console.log("subtotals",b),console.log("totals",h),console.log("annual subtotals",j),E(b),q(h),X(j),G(p);case 151:case"end":return a.stop()}}),a)})))).apply(this,arguments)}return Object(a.useEffect)((function(){!function(){K.apply(this,arguments)}()}),[i,O]),Object(d.jsxs)("div",{className:"App",children:[Object(d.jsx)(b,{class:"row"}),Object(d.jsxs)("div",{className:"container mt-4",children:[Object(d.jsx)(g,{address:i,stateChanger:h}),Object(d.jsx)(w,{network:O,stateChanger:x}),Object(d.jsx)("hr",{}),Object(d.jsx)("h3",{children:"Current Rates"}),Object(d.jsxs)("table",{className:"table",children:[Object(d.jsx)("thead",{children:Object(d.jsxs)("tr",{children:[Object(d.jsx)("th",{scope:"col",children:"Token"}),Object(d.jsx)("th",{scope:"col",children:"Deposit APY"}),Object(d.jsx)("th",{scope:"col",children:"Deposit Rewards APR"}),Object(d.jsx)("th",{scope:"col",children:"Borrow APY"}),Object(d.jsx)("th",{scope:"col",children:"Borrow Rewards APR"})]})}),Object(d.jsx)("tbody",{children:Object.entries(v).map((function(e){var t=Object(o.a)(e,2),n=t[0],a=t[1];return Object(d.jsxs)("tr",{children:[Object(d.jsx)("th",{scope:"row",children:n}),Object(d.jsx)("td",{children:a.deposit.native}),Object(d.jsx)("td",{children:a.deposit.rewards}),Object(d.jsx)("td",{children:a.borrow.native}),Object(d.jsx)("td",{children:a.borrow.rewards})]})}))})]}),Object(d.jsx)("br",{}),Object(d.jsx)("h3",{children:"User Balances (USD)"}),Object(d.jsxs)("table",{className:"table",children:[Object(d.jsx)("thead",{children:Object(d.jsxs)("tr",{children:[Object(d.jsx)("th",{scope:"col",children:"Token"}),Object(d.jsx)("th",{scope:"col",children:"Deposits"}),Object(d.jsx)("th",{scope:"col",children:"Borrows"}),Object(d.jsx)("th",{scope:"col",children:"Total"})]})}),Object(d.jsx)("tbody",{children:U.map((function(e,t){return Object(d.jsxs)("tr",{children:[Object(d.jsx)("th",{scope:"row",children:e.symbol}),Object(d.jsx)("td",{children:e.deposits}),Object(d.jsx)("td",{children:e.debt}),Object(d.jsx)("td",{children:e.sum})]})}))}),Object(d.jsx)("tfoot",{children:Object(d.jsxs)("tr",{children:[Object(d.jsx)("th",{scope:"row",children:"Total"}),Object(d.jsx)("td",{className:"bold",children:_.deposits}),Object(d.jsx)("td",{className:"bold",children:_.debt}),Object(d.jsx)("td",{className:"bold",children:_.sum})]})})]}),Object(d.jsx)("br",{}),Object(d.jsx)("h3",{children:"Annual Interest (projected)"}),Object(d.jsxs)("table",{className:"table",children:[Object(d.jsx)("thead",{children:Object(d.jsxs)("tr",{children:[Object(d.jsx)("th",{scope:"col",children:"Token"}),Object(d.jsx)("th",{scope:"col",children:"Native Interest"}),Object(d.jsx)("th",{scope:"col",children:"Rewards"}),Object(d.jsx)("th",{scope:"col",children:"Total"})]})}),Object(d.jsx)("tbody",{children:H.map((function(e,t){return Object(d.jsxs)("tr",{children:[Object(d.jsx)("th",{scope:"row",children:e.symbol}),Object(d.jsx)("td",{children:e.native.USD}),Object(d.jsx)("td",{children:e.rewards.USD}),Object(d.jsx)("td",{children:e.total.USD})]})}))}),Object(d.jsx)("tfoot",{children:Object(d.jsxs)("tr",{children:[Object(d.jsx)("th",{scope:"col",className:"total",children:"Total"}),Object(d.jsx)("td",{className:"bold",children:z.native}),Object(d.jsx)("td",{className:"bold",children:z.rewards}),Object(d.jsx)("td",{className:"bold",children:z.sum})]})})]})]})]})},_=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,507)).then((function(t){var n=t.getCLS,a=t.getFID,s=t.getFCP,r=t.getLCP,c=t.getTTFB;n(e),a(e),s(e),r(e),c(e)}))};c.a.render(Object(d.jsx)(s.a.StrictMode,{children:Object(d.jsx)(W,{})}),document.getElementById("root")),_()}},[[501,1,2]]]);
//# sourceMappingURL=main.8f96a03c.chunk.js.map