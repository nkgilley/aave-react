(this["webpackJsonpaave-react"]=this["webpackJsonpaave-react"]||[]).push([[0],{208:function(e,t,n){},210:function(e,t,n){},224:function(e,t){},227:function(e,t){},230:function(e,t){},234:function(e,t){},261:function(e,t){},263:function(e,t){},277:function(e,t){},279:function(e,t){},310:function(e,t){},312:function(e,t){},404:function(e,t){},405:function(e,t){},498:function(e,t,n){},500:function(e,t,n){},501:function(e,t,n){"use strict";n.r(t);n(203);var a=n(16),s=n.n(a),r=n(199),c=n.n(r),o=(n(208),n(14)),i=n(46),l=n(17),u=n.n(l),d=(n(210),n(4)),b=n(5),h=n(20),j=n(9),p=n(10),O=n(79),x=n.n(O),m=(n(498),n(1)),f=function(e){Object(j.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={value:a.props.address},a.address=a.state.value,a.stateChanger=a.props.stateChanger,a.handleChange=a.handleChange.bind(Object(h.a)(a)),a.handleSubmit=a.handleSubmit.bind(Object(h.a)(a)),a.connectMetamask=a.connectMetamask.bind(Object(h.a)(a)),a}return Object(b.a)(n,[{key:"handleChange",value:function(e){this.setState({value:e.target.value})}},{key:"handleSubmit",value:function(e){var t=this.state.value.toLowerCase();x.a.utils.isAddress(t)?(this.stateChanger(t),this.address=t):alert("Invalid ethereum address: "+t),e.preventDefault()}},{key:"connectMetamask",value:function(){var e=Object(i.a)(u.a.mark((function e(t){var n,a,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(){return(a=Object(i.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new x.a(x.a.givenProvider||"ws://localhost:8545"),e.next=3,t.eth.requestAccounts();case 3:return n=e.sent,console.log("update state",n[0]),e.abrupt("return",n[0].toLowerCase());case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)},n=function(){return a.apply(this,arguments)},console.log("event",t),e.next=5,n();case 5:s=e.sent,console.log("mmaccount",s),this.setState({value:s}),this.stateChanger(s),this.address=s;case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return Object(m.jsx)("form",{onSubmit:this.handleSubmit,children:Object(m.jsxs)("div",{className:"row",children:[Object(m.jsxs)("div",{className:"col-8",children:[Object(m.jsx)("label",{for:"addressInput",children:"Address:"}),Object(m.jsx)("input",{id:"addressInput",type:"text",value:this.state.value,onChange:this.handleChange}),Object(m.jsx)("input",{type:"submit",value:"Manual",className:"btn btn-secondary"})]}),Object(m.jsx)("div",{className:"col-4",children:Object(m.jsx)("button",{type:"button",className:"btn btn-primary float-end",onClick:this.connectMetamask,children:"Connect Metamask"})})]})})}}]),n}(a.Component),v=f,g=(n(500),function(e){Object(j.a)(n,e);var t=Object(p.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this,e)).state={value:a.props.network},a.stateChanger=a.props.stateChanger,a.handleChange=a.handleChange.bind(Object(h.a)(a)),a}return Object(b.a)(n,[{key:"handleChange",value:function(e){this.setState({value:e.target.value}),this.stateChanger(e.target.value)}},{key:"render",value:function(){return Object(m.jsx)("form",{children:Object(m.jsx)("div",{className:"row justify-content-end mt-2",children:Object(m.jsx)("div",{className:"col-3",children:Object(m.jsxs)("select",{id:"selectNetwork",className:"form-select",value:this.state.value,onChange:this.handleChange,children:[Object(m.jsx)("option",{value:"eth",children:"Mainnet"}),Object(m.jsx)("option",{value:"avax",children:"Avalanche"}),Object(m.jsx)("option",{value:"matic",children:"Matic"})]})})})})}}]),n}(a.Component)),w=n(506),k=Intl.NumberFormat("en-US",{style:"currency",currency:"USD",currencySign:"accounting"}),y=Intl.NumberFormat("en-US",{style:"percent",minimumFractionDigits:2}),S="https://api.thegraph.com/subgraphs/name/aave/protocol-v2-avalanche",C="https://api.thegraph.com/subgraphs/name/aave/aave-v2-matic",T="https://api.thegraph.com/subgraphs/name/aave/protocol-v2",A="\nquery {\n  reserves (where: {}) {\n    id\n    name\n    price {\n      id\n      priceInEth\n    }\n    liquidityRate\n    variableBorrowRate\n    stableBorrowRate\n    aEmissionPerSecond\n    vEmissionPerSecond\n    decimals\n    totalATokenSupply\n    totalCurrentVariableDebt\n    symbol\n  }\n}\n",D={};function N(e){return F.apply(this,arguments)}function F(){return(F=Object(i.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=t.replace(".e","").replace("W",""))in D)){e.next=4;break}e.next=17;break;case 4:if("USDT"===t){e.next=16;break}if("XSUSHI"===t){e.next=11;break}return e.next=8,fetch("https://api.binance.com/api/v3/ticker/price?symbol=".concat(t,"USDT")).then((function(e){return e.json()})).catch((function(e){return-1})).then((function(e){return e.hasOwnProperty("price")?parseFloat(e.price):(console.log("fetched from binance: ",t,D[t]),-1)}));case 8:D[t]=e.sent,e.next=14;break;case 11:return e.next=13,fetch("https://api.coingecko.com/api/v3/simple/price?ids=".concat(t,"&vs_currencies=usd")).then((function(e){return e.json()})).catch((function(e){return-1})).then((function(e){return e.hasOwnProperty(t.toLowerCase())?parseFloat(e[t.toLowerCase()].usd):(console.log("fetched from coingecko: ",t,D[t]),-1)}));case 13:D[t]=e.sent;case 14:e.next=17;break;case 16:return e.abrupt("return",1);case 17:return e.abrupt("return",D[t]);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return I.apply(this,arguments)}function I(){return(I=Object(i.a)(u.a.mark((function e(t){var n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N(t);case 2:return n=e.sent,e.next=5,N("ETH");case 5:return a=e.sent,console.log("eth price of ",t,a),e.abrupt("return",n/a);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U=Object(w.a)({url:S}),E=Object(w.a)({url:T}),R={matic:Object(w.a)({url:C}),avax:U,eth:E},P={matic:"WMATIC",avax:"WAVAX",eth:"WETH"};var B=function(){var e=Math.pow(10,27),t=Math.pow(10,18),n=Math.pow(10,18),s=31536e3,r=Object(a.useState)(""),c=Object(o.a)(r,2),l=c[0],d=c[1],b=Object(a.useState)("avax"),h=Object(o.a)(b,2),j=h[0],p=h[1],O=Object(a.useState)({}),x=Object(o.a)(O,2),f=x[0],w=x[1],S=Object(a.useState)([]),C=Object(o.a)(S,2),T=(C[0],C[1]),D=Object(a.useState)([]),F=Object(o.a)(D,2),I=F[0],U=F[1],E=Object(a.useState)({}),B=Object(o.a)(E,2),W=B[0],_=B[1],q=Object(a.useState)([]),L=Object(o.a)(q,2),V=L[0],H=L[1],X=Object(a.useState)({}),J=Object(o.a)(X,2),Y=J[0],z=J[1];function G(){return(G=Object(i.a)(u.a.mark((function a(){var r,c,i,d,b,h,p,O,x,m,f,v,g,S,C,D,F,I,E,B,W,q,L,V,X,J,Y,G,K,Q,Z,$,ee,te,ne,ae,se,re,ce,oe,ie,le,ue,de,be,he,je,pe,Oe,xe,me,fe,ve,ge,we,ke,ye,Se,Ce,Te,Ae;return u.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(l&&0!==l.length){a.next=2;break}return a.abrupt("return");case 2:return T([]),U([]),_({}),w({}),H([]),z({}),r='\n    {\n      userReserves(where: { user: "'.concat(l,'"}) {\n        id\n        reserve{\n          id\n          symbol\n        }\n        currentATokenBalance\n        currentTotalDebt\n      }\n    }\n    '),console.log("query",r),c=R[j],i=P[j],a.next=14,c.query(r).toPromise();case 14:d=a.sent,console.log("resp",d),T(d.data.userReserves),b=[],h={deposits:0,debt:0,sum:0},p=[],O={native:0,rewards:0,sum:0},x=["ETH","MATIC","AVAX"],m=0;case 23:if(!(m<d.data.userReserves.length)){a.next=49;break}return f=d.data.userReserves[m],v=f.reserve.symbol,g=t,(v.indexOf("USDC")>-1||v.indexOf("USDT")>-1)&&(g=Math.pow(10,6)),S=parseFloat(f.currentATokenBalance)/g,C=parseFloat(f.currentTotalDebt)/g,D={symbol:v,debt:0,deposits:0},console.log("tally",v,S,C),a.next=34,N(v);case 34:if(-1!==(F=a.sent)){a.next=37;break}return a.abrupt("continue",46);case 37:S>0&&(D.deposits+=S*F),C>0&&(D.debt+=C*F),h.deposits+=D.deposits,h.debt+=D.debt,h.sum+=D.deposits-D.debt,D.sum=k.format(D.deposits-D.debt),D.deposits=k.format(D.deposits),D.debt=k.format(D.debt),(S>0||C>0)&&(x.push(v),b.push(D));case 46:m++,a.next=23;break;case 49:return console.log("token list",x),console.log(j),console.log(c),a.next=54,c.query(A).toPromise();case 54:return I=a.sent,E={},a.next=58,M(i.replace("W",""));case 58:B=a.sent,m=0;case 60:if(!(m<I.data.reserves.length)){a.next=94;break}if(W=I.data.reserves[m],q=W.symbol,console.log("111111",q,x),x.includes(q)){a.next=66;break}return a.abrupt("continue",91);case 66:return L=parseFloat(W.variableBorrowRate),V=parseFloat(W.liquidityRate),X=parseFloat(W.aEmissionPerSecond),J=parseFloat(W.vEmissionPerSecond),Y=parseFloat(W.totalCurrentVariableDebt),G=parseFloat(W.totalATokenSupply),a.next=74,M(q);case 74:K=a.sent,Q=Math.pow(10,parseFloat(W.decimals)),Z=V/e,$=L/e,ee=Math.pow(1+Z/s,s)-1,te=Math.pow(1+$/s,s)-1,ne=X*s,ae=J*s,console.log("======================== "+q+" ================================="),console.log("(aEmissionPerYear * REWARD_PRICE_ETH * WEI_DECIMALS)",ne,B,t),console.log("(totalATokenSupply * token_price_eth * underlying_token_decimals)",G,K,Q),console.log("======================== "+q+" ================================="),se=ne*B*Q/(G*K*n),re=ae*B*Q/(Y*K*n),E[q]={deposit:{native:ee},borrow:{native:te}},E[q].deposit.rewards=se,E[q].borrow.rewards=Y>0?re:0;case 91:m++,a.next=60;break;case 94:console.log("rate",E),w(E),m=0;case 97:if(!(m<d.data.userReserves.length)){a.next=133;break}if(ce=d.data.userReserves[m],oe=ce.reserve.symbol,x.includes(oe)){a.next=102;break}return a.abrupt("continue",130);case 102:if(console.log(oe,x),ie=t,(oe.indexOf("USDC")>-1||oe.indexOf("USDT")>-1)&&(ie=Math.pow(10,6)),le=parseFloat(ce.currentATokenBalance)/ie,ue=parseFloat(ce.currentTotalDebt)/ie,0!==le||0!==ue){a.next=109;break}return a.abrupt("continue",130);case 109:return console.log("Annual rewards for this symbol",oe),de=le*E[oe].deposit.native-ue*E[oe].borrow.native,a.next=113,N(oe);case 113:return be=a.sent,he=de*be,console.log("nativeusd",he),a.next=118,N("AVAX");case 118:je=a.sent,pe=le*be*E[oe].deposit.rewards,Oe=ue*be*E[oe].borrow.rewards,xe=(pe+Oe)/je,console.log(oe+" Rewards",pe,Oe),me=pe+Oe,console.log("rewards",me),O.native+=he,O.rewards+=me,O.sum+=he+me,fe={symbol:oe,native:{USD:k.format(he),native:de},rewards:{USD:k.format(me),WAVAX:xe},total:{USD:k.format(he+me)}},p.push(fe);case 130:m++,a.next=97;break;case 133:for(ve=0,ge=Object.entries(E);ve<ge.length;ve++)for(we=Object(o.a)(ge[ve],2),ke=we[0],ye=we[1],Se=0,Ce=Object.entries(ye);Se<Ce.length;Se++)Te=Object(o.a)(Ce[Se],2),Ae=Te[0],Te[1],console.log("1",E[ke][Ae].native),console.log("2",E[ke][Ae].rewards),E[ke][Ae].native=y.format(E[ke][Ae].native),E[ke][Ae].rewards=y.format(E[ke][Ae].rewards),console.log("3",E[ke][Ae].native),console.log("4",E[ke][Ae].rewards);console.log(E),w(E),h.deposits=k.format(h.deposits),h.debt=k.format(h.debt),h.sum=k.format(h.sum),O.native=k.format(O.native),O.rewards=k.format(O.rewards),O.sum=k.format(O.sum),console.log("subtotals",b),console.log("totals",h),console.log("annual subtotals",p),U(b),_(h),H(p),z(O);case 149:case"end":return a.stop()}}),a)})))).apply(this,arguments)}return Object(a.useEffect)((function(){!function(){G.apply(this,arguments)}()}),[l,j]),Object(m.jsx)("div",{className:"App",children:Object(m.jsxs)("div",{className:"container mt-4",children:[Object(m.jsx)("h1",{children:"AAVE Profit Calculator"}),Object(m.jsx)("hr",{}),Object(m.jsx)(v,{address:l,stateChanger:d}),Object(m.jsx)(g,{network:j,stateChanger:p}),Object(m.jsx)("hr",{}),Object(m.jsx)("h3",{children:"Current Rates"}),Object(m.jsxs)("table",{className:"table",children:[Object(m.jsx)("thead",{children:Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{scope:"col",children:"Token"}),Object(m.jsx)("th",{scope:"col",children:"Deposit"}),Object(m.jsx)("th",{scope:"col",children:"Deposit Incentives"}),Object(m.jsx)("th",{scope:"col",children:"Borrow"}),Object(m.jsx)("th",{scope:"col",children:"Borrow Incentives"})]})}),Object(m.jsx)("tbody",{children:Object.entries(f).map((function(e){var t=Object(o.a)(e,2),n=t[0],a=t[1];return Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{scope:"row",children:n}),Object(m.jsx)("td",{children:a.deposit.native}),Object(m.jsx)("td",{children:a.deposit.rewards}),Object(m.jsx)("td",{children:a.borrow.native}),Object(m.jsx)("td",{children:a.borrow.rewards})]})}))})]}),Object(m.jsx)("br",{}),Object(m.jsx)("h3",{children:"User Balances (USD)"}),Object(m.jsxs)("table",{className:"table",children:[Object(m.jsx)("thead",{children:Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{scope:"col",children:"Token"}),Object(m.jsx)("th",{scope:"col",children:"Deposits"}),Object(m.jsx)("th",{scope:"col",children:"Borrows"}),Object(m.jsx)("th",{scope:"col",children:"Total"})]})}),Object(m.jsx)("tbody",{children:I.map((function(e,t){return Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{scope:"row",children:e.symbol}),Object(m.jsx)("td",{children:e.deposits}),Object(m.jsx)("td",{children:e.debt}),Object(m.jsx)("td",{children:e.sum})]})}))}),Object(m.jsx)("tfoot",{children:Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{scope:"row",children:"Total"}),Object(m.jsx)("td",{className:"bold",children:W.deposits}),Object(m.jsx)("td",{className:"bold",children:W.debt}),Object(m.jsx)("td",{className:"bold",children:W.sum})]})})]}),Object(m.jsx)("br",{}),Object(m.jsx)("h3",{children:"Annual Profits (projected)"}),Object(m.jsxs)("table",{className:"table",children:[Object(m.jsx)("thead",{children:Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{scope:"col",children:"Token"}),Object(m.jsx)("th",{scope:"col",children:"Native Interest"}),Object(m.jsx)("th",{scope:"col",children:"Incentives"}),Object(m.jsx)("th",{scope:"col",children:"Total"})]})}),Object(m.jsx)("tbody",{children:V.map((function(e,t){return Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{scope:"row",children:e.symbol}),Object(m.jsx)("td",{children:e.native.USD}),Object(m.jsx)("td",{children:e.rewards.USD}),Object(m.jsx)("td",{children:e.total.USD})]})}))}),Object(m.jsx)("tfoot",{children:Object(m.jsxs)("tr",{children:[Object(m.jsx)("th",{scope:"col",className:"total",children:"Total"}),Object(m.jsx)("td",{className:"bold",children:Y.native}),Object(m.jsx)("td",{className:"bold",children:Y.rewards}),Object(m.jsx)("td",{className:"bold",children:Y.sum})]})})]})]})})},W=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,507)).then((function(t){var n=t.getCLS,a=t.getFID,s=t.getFCP,r=t.getLCP,c=t.getTTFB;n(e),a(e),s(e),r(e),c(e)}))};c.a.render(Object(m.jsx)(s.a.StrictMode,{children:Object(m.jsx)(B,{})}),document.getElementById("root")),W()}},[[501,1,2]]]);
//# sourceMappingURL=main.bdb81c89.chunk.js.map